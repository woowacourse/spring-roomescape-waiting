# 기능 명세

## 예약 정책

- 같은 테마, 날짜 시간에는 한 사람만 예약이 가능하다.
- 이미 예약이 존재하는데, 예약을 하게 되는 경우에는 자동으로 예약 대기 상태가 되고 대기 번호를 부여 받는다.
- 예약 대기 버튼을 눌렀는데, 예약이 비어있을 경우 자동으로 예약된다.
- 예약자가 예약을 취소할 경우 자동으로 1번 대기 예약자가 예약자가 된다.
- 예약자는 나의 예약 페이지에서 자신의 예약, 대기 번호, 예약 취소, 예약 거절 상태를 확인할 수 있다.
- 같은 테마, 날짜 시간에는 여러번 예약할 수 없다.
- 자신의 예약 대기만 취소할 수 있고, 예약의 경우 온라인으로 취소할 수 없다.

## Admin PAGE

- [X] `/admin` `GET` 요청 시 어드민 메인 페이지를 응답한다.
- [X] `/admin/reservation/reserved` `GET` 요청 시 예약 관리 페이지를 응답한다.
- [X] `/admin/reservation/waiting` `GET` 요청 시 예약 대기 관리 페이지를 응답한다.
- [X] `/admin/time` `GET` 요청 시 시간 관리 페이지를 응답한다.
- [X] `/admin/theme` `GET` 요청 시 테마 관리 페이지를 응답한다.

## Reservation PAGE

- [X] `/reservation` `GET` 요청 시 예약 페이지를 응답한다.

## Reservation API

- [X] `/reservations` `GET` 요청 시 예약 및 예약 대기 목록을 조회하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] 회원의 이메일이 DB에 존재하지 않으면 예외를 발생시키고 상태코드 401을 반환한다.
- [X] `/reservations` `POST` 요청 시 예약을 추가하고 API 명세에 맞게 응답을 반환한다.
    - [X] 예약 버튼을 눌렀어도 동시에 예약이 발생하여 이미 예약이 존재하게 될 경우 자동으로 예약 대기 순번을 부여받는다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] 테마 아이디, 예약 날짜, 시간 아이디가 비어있으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 예약 날짜가 형식에 맞지 않으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 테마 아이디가 자연수가 아니라면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 예약 시간 아이디가 자연수가 아니라면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 회원의 이메일이 DB에 존재하지 않으면 예외를 발생시키고 상태코드 404를 반환한다.
    - [x] 예약 시간 아이디가 DB에 존재하지 않으면 예외를 발생시키고 상태코드 404을 반환한다.
    - [x] 테마 아이디가 DB에 존재하지 않으면 예외를 발생시키고 상태코드 404을 반환한다.
    - [x] 현재보다 이전 날짜 및 시간이라면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 이미 해당 테마 같은 시간 날짜에 예약 혹은 예약 대기가 존재하면 예외를 발생시키고 상태코드 409를 반환한다.
- [x] `/reservations/waiting` `POST` 요청 시 예약 대기를 추가하고 API 명세에 맞게 응답을 반환한다.
    - [x] 예약 대기 추가 과정은 예약 추가 과정과 동일하게 이루어진다.
    - [x] 예약 대기 버튼을 눌렀어도 해당 시점에 예약이 존재하지 않을 경우 자동으로 예약된다.
    - [x] 이미 같은 날짜 시각 테마에 예약 또는 예약 대기가 존재하면 중복 예약을 막고 예외를 발생시키고 상태코드 409를 반환한다.
- [X] `/reservations/waiting/{id}` `DELETE` 요청 시 예약 대기를 삭제하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] 요청한 회원의 이메일이 DB에 존재하지 않으면 예외를 발생시키고 상태코드 404를 반환한다.
    - [x] 요청한 예약 아이디가 DB에 존재하지 않거나 예약 대기 상태가 아닌 경우 예외를 발생시키고 상태코드 404를 반환한다.
- [x] `/admin/reservations/confirmed?member=&theme=&start-date=&end-date` `GET` 요청 시 검색 조건에 따른 예약 확정 목록을 조회한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [x] 회원, 테마, 검색 시작 날짜, 검색 마지막 날짜 조건을 동적으로 처리해서 목록을 조회한다.
- [x] `/admin/reservations/waiting `GET` 요청 시 예약 대기 목록을 조회한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
- [X] `/admin/reservations` `POST` 요청 시 예약을 추가하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [x] 검증 과정은 `/reservations` `POST` 과 같다.
- [X] `/admin/reservations/{id}` `DELETE` 요청 시 예약을 삭제하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [x] 존재하지 않는 아이디를 삭제하려고 하면 예외를 발생시키고 상태코드 404를 반환한다.
    - [x] 같은 테마,날짜,시간에 대기중인 예약이 존재할 경우 해당 예약 상태를 대기에서 확정으로 변경한다.
- [X] `/admin/reservations/waiting/{id}` `DELETE` 요청 시 예약 대기를 삭제하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.

## Time API

- [X] `/times` `GET` 요청 시 시간 목록을 조회하고 API 명세에 맞게 응답을 반환한다.
- [X] `/admin/times` `POST` 요청 시 시간을 추가하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [X] 시작 시간이 null이라면 예외를 발생시키고 상태코드 400을 반환한다.
    - [X] 시작 시간이 형식에 맞지 않는다면 예외를 발생시키고 상태코드 400을 반환한다.
    - [X] 시작 시간이 이미 DB에 존재하면 예외를 발생시키고 상태코드 409를 반환한다.
- [X] `/admin/times/{id}` `DELETE` 요청 시 시간을 삭제하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [X] 예약이 존재하는 시간을 삭제하려고 하면 예외를 발생시키고 상태코드 400을 반환한다.
- [X] `/times/available?date=${date}&themeId=${themeId}` `GET` 요청 시 시간 목록을 조회하고 API 명세에 맞게 응답을 반환한다.
    - [X] 날짜, 테마 아이디가 비어있으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [X] 예약 날짜가 형식에 맞지 않는다면 예외를 발생시키고 상태코드 400을 반환한다.
    - [X] 테마 아이디가 자연수가 아니라면 예외를 발생시키고 상태코드 400을 반환한다.

## Theme PAGE

- [x] `/` `GET` 요청 시 인기 테마 페이지를 응답한다.

## Theme API

- [x] `/themes` `GET` 요청 시 테마 목록을 조회하고 API 명세에 맞게 응답을 반환한다.
- [x] `/admin/themes` `POST` 요청 시 테마를 추가하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [x] 테마 이름, 테마 설명, 테마 썸네일이 비어있다면 예외를 발생시키고 상태코드 400을 반환한다.
- [x] `/admin/themes` `DELETE` 요청 시 테마를 삭제하고 API 명세에 맞게 응답을 반환한다.
    - [x] jwt 토큰 검증을 통해 올바른 토큰인지 검사한다.
    - [x] jwt 토큰을 확인하여 권한이 어드민인 경우만 접근할 수 있다.
    - [x] 예약이 존재하는 테마를 삭제하려고 하면 예외를 발생시키고 상태코드 400을 반환한다.
- [X] `/themes/popular?start-date=2024-05-02&end-date=2024-05-09&count=10` `GET` 요청 시 예약이 많은 순서로 인기 테마 결과를 API 명세에 맞게
  반환한다.

## Member PAGE

- [x] `/signup` `GET` 요청 시 회원 가입 페이지를 응답한다.
- [x] `/login` `GET` 요청 시 로그인 페이지를 응답한다.

## Member API

- [x] `/members/signup` `POST` 요청 시 회원 가입을 요청하고 API 명세에 맞게 응답을 반환한다.
    - [x] 회원 이메일 형식이 맞지 않으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 회원 비밀번호 형식이 맞지 않으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 회원 이름 형식이 맞지 않으면 예외를 발생시키고 상태코드 400을 반환한다.
    - [x] 이미 DB에 존재하는 회원 이메일일 경우 예외를 발생시키고 상태코드 409를 반환한다.
- [x] `/members/login` `POST` 요청 시 회원 로그인을 요청하고 API 명세에 맞게 응답을 반환한다.
    - [x] 회원 이메일이 DB에 존재하지 않을 경우 예외를 발생시키고 상태코드 401을 반환한다.
    - [X] 회원 비밀번호가 일치하지 않을 경우 예외를 발생시키고 상태코드 401을 반환한다.
    - [X] 로그인에 성공하면 jwt 토큰을 발급한다.
- [x] `/members/login/check` `GET` 요청 시 토큰의 유효성을 검사하고 API 명세에 맞게 응답을 반환한다.
    - [x] 쿠키에 토큰이 존재하지 않을 경우 예외를 발생시키고 상태코드 401을 반환한다.
    - [x] 기한이 만료된 토큰일 경우 예외를 발생시키고 상태코드 401을 반환한다.
    - [x] 올바르지 않은 형식의 토큰일 경우 예외를 발생시키고 상태코드 401을 반환한다.
    - [x] 토큰 유효성 검사에 실패할 경우 예외를 발생시키고 상태코드 401을 반환한다.
- [x] `/members/logout` `POST` 요청 시 토큰을 만료시키고 API 명세에 맞게 응답을 반환한다.
- [x] `/admin/members` `GET` 요청 시 토큰을 확인하여 회원 이름 정보를 응답한다.
