## 3단계 - 예약 대기 기능 

### 기능 요구사항
- [x] 이미 예약이 되었다면, 같은 날짜, 시간, 테마를 선택했을 때 예약 대기 버튼만 활성화된다.
- [x] 중복 예약은 불가능하다.
- [x] 회원은 예약 대기를 취소할 수 있으며, 예약은 관리자만 취소 가능하다.
- [x] 회원이 자신의 예약 목록을 조회하면 대기중인 예약도 같이 조회된다.
  - [x] 대기중인 예약은 몇 번째 순번인지 같이 표시한다. (ex) 'N번째 예약대기'

### 기능 구현 개요
- 별도의 대기 테이블을 만들지 않고, 기존의 reservation 테이블에 status 및 createAt 컬럼을 추가하였습니다.
  - status 값으로 예약 및 대기 상태를 구분합니다.
  - createAt은 JPA의 Auditing을 이용하여 테이블에 추가되는 시간으로 기록하고, 이를 이용하여 대기 순번을 조회합니다.

- 예약을 추가할 땐 해당 시간에 예약이 이미 존재하는지 검증하고, 예약 대기를 추가할 땐 이미 예약을 했는지 검증합니다.


## 4단계 - 예약 대기 관리

### 기능 요구사항
- [x] 관리자는 예약 대기 목록을 조회할 수 있다.
- [x] 관리자는 예약 대기를 승인 또는 거절할 수 있다. (승인 시, 예약 상태로 변경된다.)

### 기능 구현 개요
- 관리자가 예약 대기 목록을 조회할 때, 다음의 우선순위로 정렬합니다.
    1. 오름차순 예약 날짜
    2. 같은 날짜라면 오름차순 시간
    3. 같은 날짜, 같은 시간이면 오름차순 테마 이름
    4. 위의 모든 조건이 같다면 예약 번호(reservation 테이블의 id 컬럼값) 

- 모든 관리자 페이지에서 예약 대기 탭으로 접근할 수 있는 Waiting 탭을 추가하였습니다. 

- 예약 승인은 기존의 예약이 취소되면 자동으로 되는 것이 아닌, 관리자가 수동으로 승인합니다.
  - 예약을 승인할 때, 기존의 예약이 존재하는지 한번 더 검증합니다.
  
- 관리자의 예약 대기 거절은, 대기 순번과 무관하게 가능합니다.

- 구현 과정에서 로그인 상태가 아니면 로그인 페이지('/login')로 리다이렉트하도록 수정하였습니다.


## API 개요

### 인증, 인가
| API          | METHOD | 기능                       | 비고                                               |
|--------------|--------|--------------------------|--------------------------------------------------|
| /login       | POST   | 이메일, 비밀번호를 이용하여 로그인한다.   |                                                  |
| /login/check | GET    | 쿠키의 토큰 정보로 로그인 여부를 확인한다. | 로그인이 되어있지 않을 때 로그인이 필요한 페이지 접근시 '/login'으로 리다이렉트 |
| /logout      | POST   | 로그아웃 한다.                 | 쿠키의 토큰 정보를 지운다.                                  |

### 회원
| API      | METHOD | 기능        | 비고             |
|----------|--------|-----------|----------------|
| /members | GET    | 모든 회원을 조회 | 로그인 상태이면 접근 가능 |

- 현재는 모든 로그인된 회원이 접근이 가능하나, 관리자만 접근 가능하도록 수정 예정입니다.

### 시간
| API                                         | METHOD | 기능                                     | 비고             |
|---------------------------------------------|--------|----------------------------------------|----------------|
| /times                                      | GET    | 모든 시간을 조회한다.                           | 로그인 상태이면 접근 가능 |
| /times/filter?date={date}&themeId={themeId} | GET    | 해당 날짜와 테마에 대한 모든 시간에 예약 여부를 포함하여 조회한다. | 로그인 상태이면 접근 가능 |
| /admin/times                                | POST   | 예약 시간을 추가한다.                           | 관리자만 접근 가능     |
| /admin/times/{id}                           | DELETE | 예약 시간을 삭제한다.                           | 관리자만 접근 가능     |

### 테마
| API                | METHOD | 기능                          | 비고             |
|--------------------|--------|-----------------------------|----------------|
| /themes            | GET    | 모든 테마를 조회한다.                | 로그인 상태이면 접근 가능 |
| /themes/ranking    | GET    | 지난 일주일간 가장 많이 예약된 테마를 조회한다. | 홈 화면, 모두 접근 가능 |
| /admin/themes      | POST   | 테마를 추가한다.                   | 관리자만 접근 가능     |
| /admin/themes/{id} | DELETE | 테마를 삭제한다.                   | 관리자만 접근 가능     |

### 예약 및 대기
#### 회원
| API                        | METHOD | 기능                     | 비고               |
|----------------------------|--------|------------------------|------------------|
| /reservations              | GET    | 모든 예약을 조회한다.           |   |
| /reservations              | POST   | 예약을 추가한다.              |  |
| /reservations/mine         | GET    | 회원이 자신의 예약 및 대기를 조회한다. |   |
| /reservations/waiting      | POST   | 예약 대기를 추가한다.           |    |
| /reservations/waiting/{id} | DELETE | 예약 대기를 취소한다.           |   |

#### 관리자
| API                                                                                           | METHOD | 기능                          | 비고               |
|-----------------------------------------------------------------------------------------------|--------|-----------------------------|------------------|
| /admin/reservations                                                                           | POST   | 관리자 페이지에서 예약을 추가한다.         |        |
| /admin/reservations?themeId={themeId}&memberId={memberId}&dateFrom={dateFrom}&dateTo={dateTo} | POST   | 관리자가 회원,테마,기간에 맞는 예약을 조회한다. | 값이 들어있지 않으면 전체를 조회한다. |
| /admin/reservations/{id}                                                                      | DELETE | 관리자 페이지에서 예약을 삭제한다.         |     |
| /admin/reservations/waiting                                                                   | GET    | 관리자가 모든 예약 대기 목록을 조회한다.     | |
| /admin/reservations/waiting/{id}/approve                                                      | POST   | 대기중인 예약을 승인한다.              |    |
| /admin/reservations/waiting/{id}/deny                                                         | POST   | 대기중인 예약을 거절한다.              |                  |

